## 范围链

目录
0. 术语翻译对照
1. 介绍
2. 范围链定义
3. 函数生命周期
4. 范围链特性
	1. 闭包
	2. 范围链查找的两种维度
	3. 代码执行过程中对范围链的影响
5. 参考文献

### 0. 术语翻译对照
Scope：范围
Scope chain：范围链，本文不对范围和范围链作区分，两者是同一个东西
Execution context：执行上下文。
Variable object：变量对象。函数调用 --> 1. 进入（创建）执行上下文，创建变量对象（把变量声明、函数声明、函数参数作为其属性）；2. 代码执行，变量对象上属性的值相应变化 --> 函数返回，变量对象小时

### 1. 介绍

范围链是个与执行上下文紧密相关的抽象概念，我们知道，在调用函数的时候会创建函数的执行上下文，变量声明、函数声明和函数参数作为属性关联到函数的活动对象上，继而执行代码，活动对象上的属性随之变化。

函数可以相互嵌套，每个函数执行上下文都有它自己的活动对象，对于全局上下文来说，是全局对象，内部函数如何访问外围函数活动对象上的变量呢？通过范围链。

### 2. 范围链定义
> 范围链是一条和执行上下文关联的变量对象（variable objects）的链接，用于标识符解析（identifier resolution）过程中找到变量的值。

按照定义，可以把范围链理解成一个列表，里面依次装了外部函数的活动对象。

范围链是什么时候生成的？不是用户写程序的时候，而是写完程序，放到浏览器里运行，JS 引擎扫描程序，扫描到函数调用的地方，就创建相应的执行上下文、变量对象以及范围链。

用伪代码进行语义上的表示就是：
```javascript
activeExecutionContext = { // 当前的活动执行上下文，包含了以下东西：
	VO: {...}, // 变量活动 or 活动对象
	this: thisValue, // this 值
	Scope: [ // 范围链，一个列表，里面依次存放外部函数的变量对象
	] 
};
```

### 3. 函数生命周期
函数生命周期分为两个阶段：创建和调用。
#### 3.1 函数创建
在进入执行环境上下文时，函数声明被放到 变量对象/活动对象上，函数能够访问外部执行环境的变量对象，通过函数内部属性`[[Scope]]` 实现：
> `[[Scope]]` 是一条链接，把所有父级变量对象一层层链接起来，这条链在函数被创建的时候就已经保存了。

`[[Scope]]`是在函数创建的时候就已经保存了的，并且是静态保存不再变化，一直到函数结束运行。即便一个函数没有被调用，它也会有`[[Scope]]`属性存在函数对象上，注意 `[[Scope]]`属性不是上下文的属性，而是函数的属性。举一个例子：
```javascript
var x = 10;

function foo() {
  var y = 20;
  alert(x + y);
}

foo(); // 30
```
`foo()` 函数的`[[Scope]]`属性是这样：
```javascript
foo.[[Scope]] = [
	globalContext.VO // === Global
];
```
也就是说，在`foo` 函数被调用之前，`[[Scope]]`属性就已经存在了，里面放的是全局变量对象。接着就是调用函数，进入它的执行上下文，创建它的活动对象，确定`this` 和 范围链。

#### 3.2 函数执行

### 4. 范围链特性
#### 4.1 闭包

#### 4.2 范围链查找的两种维度

#### 4.3 代码执行过程中对范围链的影响

### 5. 参考文献






